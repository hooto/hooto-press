// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE
/* Just enough of CodeMirror to run runMode under node.js */function splitLines(e){return e.split(/\r\n?|\n/)}function StringStream(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0}function copyObj(e,t,n){t||(t={});for(var r in e)e.hasOwnProperty(r)&&(n!==!1||!t.hasOwnProperty(r))&&(t[r]=e[r]);return t}var countColumn=function(e,t,n,r,i){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var s=r||0,o=i||0;;){var u=e.indexOf("	",s);if(u<0||u>=t)return o+(t-s);o+=u-s,o+=n-o%n,s=u+1}};StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,n){if(typeof e!="string"){var s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&t!==!1&&(this.pos+=s[0].length),s)}var r=function(e){return n?e.toLowerCase():e},i=this.string.substr(this.pos,e.length);if(r(i)==r(e))return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}},exports.StringStream=StringStream,exports.startState=function(e,t,n){return e.startState?e.startState(t,n):!0};var modes=exports.modes={},mimeModes=exports.mimeModes={};exports.defineMode=function(e,t){arguments.length>2&&(t.dependencies=Array.prototype.slice.call(arguments,2)),modes[e]=t},exports.defineMIME=function(e,t){mimeModes[e]=t},exports.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),exports.defineMIME("text/plain","null"),exports.resolveMode=function(e){return typeof e=="string"&&mimeModes.hasOwnProperty(e)?e=mimeModes[e]:e&&typeof e.name=="string"&&mimeModes.hasOwnProperty(e.name)&&(e=mimeModes[e.name]),typeof e=="string"?{name:e}:e||{name:"null"}};var modeExtensions=exports.modeExtensions={};exports.extendMode=function(e,t){var n=modeExtensions.hasOwnProperty(e)?modeExtensions[e]:modeExtensions[e]={};copyObj(t,n)},exports.getMode=function(e,t){var t=exports.resolveMode(t),n=modes[t.name];if(!n)return exports.getMode(e,"text/plain");var r=n(e,t);if(modeExtensions.hasOwnProperty(t.name)){var i=modeExtensions[t.name];for(var s in i){if(!i.hasOwnProperty(s))continue;r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=i[s]}}r.name=t.name,t.helperType&&(r.helperType=t.helperType);if(t.modeProps)for(var s in t.modeProps)r[s]=t.modeProps[s];return r},exports.registerHelper=exports.registerGlobalHelper=Math.min,exports.runMode=function(e,t,n,r){var i=exports.getMode({indentUnit:2},t),s=splitLines(e),o=r&&r.state||exports.startState(i);for(var u=0,a=s.length;u<a;++u){u&&n("\n");var f=new exports.StringStream(s[u]);!f.string&&i.blankLine&&i.blankLine(o);while(!f.eol()){var l=i.token(f,o);n(f.current(),l,u,f.start,o),f.start=f.pos}}},require.cache[require.resolve("../../lib/codemirror")]=require.cache[require.resolve("./runmode.node")],require.cache[require.resolve("../../addon/runmode/runmode")]=require.cache[require.resolve("./runmode.node")];